generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  user_id           String    @id @default(uuid()) @db.Uuid
  username          String    @unique @db.VarChar(100)
  email             String    @unique @db.VarChar(255)
  password_hash     String    @db.VarChar(255)
  diet_preferences  Json?     @default({})
  is_active         String    @default("Y") @db.Char(1)
  created_at        DateTime  @default(now()) @db.Timestamptz
  updated_at        DateTime  @default(now()) @updatedAt @db.Timestamptz
  favorites         Favorite[]
  ratings           Rating[]
  diet_plans        DietPlan[]
}

model Recipe {
  recipe_id        String        @id @default(uuid()) @db.Uuid
  title            String        @db.VarChar(255)
  description      String?       @db.Text
  ingredients      Json          @default([])
  steps            Json          @default([])
  cooking_time     Int?
  difficulty       String?       @db.VarChar(50)
  nutrition_info   Json?         @default({})
  image_url        String?       @db.VarChar(500)
  tags             Json          @default([])
  created_at       DateTime      @default(now()) @db.Timestamptz
  updated_at       DateTime      @default(now()) @updatedAt @db.Timestamptz
  favorites        Favorite[]
  ratings          Rating[]
  recipe_ingredients RecipeIngredient[]
}

model Ingredient {
  ingredient_id    Int           @id @default(autoincrement())
  name             String        @db.VarChar(255)
  category         String?       @db.VarChar(100)
  unit             String?       @db.VarChar(50)
  nutrition_data   Json?         @default({})
  created_at       DateTime      @default(now()) @db.Timestamptz
  recipe_ingredients RecipeIngredient[]
}

model RecipeIngredient {
  id             Int        @id @default(autoincrement())
  recipe_id      String     @db.Uuid
  ingredient_id  Int
  quantity       Decimal    @db.Decimal(10, 2)
  unit           String     @db.VarChar(50)
  recipe         Recipe     @relation(fields: [recipe_id], references: [recipe_id], onDelete: Cascade)
  ingredient     Ingredient @relation(fields: [ingredient_id], references: [ingredient_id])
}

model Favorite {
  favorite_id    String    @id @default(uuid()) @db.Uuid
  user_id        String    @db.Uuid
  recipe_id      String    @db.Uuid
  created_at     DateTime  @default(now()) @db.Timestamptz
  user           User      @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  recipe         Recipe    @relation(fields: [recipe_id], references: [recipe_id], onDelete: Cascade)

  @@unique([user_id, recipe_id])
}

model Rating {
  rating_id      String    @id @default(uuid()) @db.Uuid
  user_id        String    @db.Uuid
  recipe_id      String    @db.Uuid
  score          Int       @check(score >= 1 && score <= 5)
  comment        String?   @db.Text
  created_at     DateTime  @default(now()) @db.Timestamptz
  user           User      @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  recipe         Recipe    @relation(fields: [recipe_id], references: [recipe_id], onDelete: Cascade)

  @@unique([user_id, recipe_id])
}

model NutritionInfo {
  nutrition_id   Int       @id @default(autoincrement())
  calories       Decimal?  @db.Decimal(10, 2)
  protein        Decimal?  @db.Decimal(10, 2)
  carbs          Decimal?  @db.Decimal(10, 2)
  fat            Decimal?  @db.Decimal(10, 2)
  fiber          Decimal?  @db.Decimal(10, 2)
  vitamins       Json?     @default({})
  minerals       Json?     @default({})
}

model DietPlan {
  plan_id        String    @id @default(uuid()) @db.Uuid
  user_id        String    @db.Uuid
  name           String    @db.VarChar(255)
  start_date     DateTime  @db.Date
  end_date       DateTime  @db.Date
  recipes        Json?     @default([])
  created_at     DateTime  @default(now()) @db.Timestamptz
  updated_at     DateTime  @default(now()) @updatedAt @db.Timestamptz
  user           User      @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
}