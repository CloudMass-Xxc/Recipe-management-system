generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Schema definitions
model User {
  userId           String     @id @default(uuid())
  username         String     @unique @db.VarChar(100)
  email            String     @unique @db.VarChar(255)
  passwordHash     String     @db.VarChar(255)
  displayName      String     @db.VarChar(255)
  avatarUrl        String?    @db.VarChar(500)
  bio              String?    @db.Text
  dietPreferences  Json?      
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  recipes          Recipe[]
  favorites        Favorite[]
  ratings          Rating[]
  dietPlans        DietPlan[]
}

model Recipe {
  recipeId         String     @id @default(uuid())
  title            String     @db.VarChar(255)
  description      String?    @db.Text
  instructions     String     @db.Text
  cookingTime      Int
  servings         Int
  difficulty       String     @db.VarChar(50)
  authorId         String     @db.Uuid
  ingredients      Json?      
  tags             Json?      
  nutritionInfo    NutritionInfo?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  author           User       @relation(fields: [authorId], references: [userId], onDelete: Cascade)
  favorites        Favorite[]
  ratings          Rating[]
}

model Ingredient {
  ingredientId     Int        @id @default(autoincrement())
  name             String     @db.VarChar(255)
  category         String?    @db.VarChar(100)
  unit             String?    @db.VarChar(50)
  nutritionData    Json?      
  createdAt        DateTime   @default(now())
  recipeIngredients RecipeIngredient[]
}

model RecipeIngredient {
  id               Int       @id @default(autoincrement())
  recipeId         String    @db.Uuid
  ingredientId     Int
  quantity         Decimal   @db.Decimal(10, 2)
  unit             String    @db.VarChar(50)
  recipe           Recipe    @relation(fields: [recipeId], references: [recipeId], onDelete: Cascade)
  ingredient       Ingredient @relation(fields: [ingredientId], references: [ingredientId], onDelete: Cascade)
}

model Favorite {
  favoriteId       String    @id @default(uuid())
  userId           String    @db.Uuid
  recipeId         String    @db.Uuid
  createdAt        DateTime  @default(now())
  user             User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  recipe           Recipe    @relation(fields: [recipeId], references: [recipeId], onDelete: Cascade)
}

model Rating {
  ratingId         String    @id @default(uuid())
  userId           String    @db.Uuid
  recipeId         String    @db.Uuid
  score            Int       @check(score >= 1 && score <= 5)
  comment          String?   @db.Text
  createdAt        DateTime  @default(now())
  user             User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  recipe           Recipe    @relation(fields: [recipeId], references: [recipeId], onDelete: Cascade)
}

model NutritionInfo {
  nutritionId      Int       @id @default(autoincrement())
  calories         Decimal?  @db.Decimal(10, 2)
  protein          Decimal?  @db.Decimal(10, 2)
  carbs            Decimal?  @db.Decimal(10, 2)
  fat              Decimal?  @db.Decimal(10, 2)
  fiber            Decimal?  @db.Decimal(10, 2)
  vitamins         Json?     
  minerals         Json?     
  recipe           Recipe?   @relation(unique: true)
}

model DietPlan {
  planId           String    @id @default(uuid())
  userId           String    @db.Uuid
  name             String    @db.VarChar(255)
  startDate        DateTime
  endDate          DateTime
  recipes          Json?     
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  user             User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
}